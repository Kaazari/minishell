# Patch Notes - Minishell Corrections

## ProblÃ¨mes identifiÃ©s et solutions

### 1. Gestion des signaux et exit codes âœ… CORRIGÃ‰
**ProblÃ¨me :** Aucun retour de l'exit code lors de l'utilisation des diffÃ©rents signaux
**Solution :**
- âœ… ImplÃ©menter la gestion correcte de g_signal pour les signaux
- âœ… Mettre Ã  jour l'exit status aprÃ¨s les signaux
- âœ… GÃ©rer correctement $? aprÃ¨s Ctrl+C

### 2. Echo avec options multiples âœ… CORRIGÃ‰
**ProblÃ¨me :** echo -nnnnnnnn -nnnnnnnnn "abcdef" ne gÃ¨re pas correctement les options multiples
**Solution :**
- âœ… Modifier builtin_echo pour gÃ©rer les options multiples avec is_n_option()
- âœ… ImplÃ©menter la logique correcte pour traiter tous les arguments -n consÃ©cutifs
- âœ… Utiliser write(STDOUT_FILENO, ...) au lieu de printf pour Ã©viter les problÃ¨mes de buffering
- âœ… La fonction gÃ¨re maintenant correctement echo -n test et echo -nnnnnnnn -nnnnnnnnn test

### 3. Gestion des quotes âœ… CORRIGÃ‰
**ProblÃ¨me :** echo ""hello"" ne gÃ¨re pas correctement les quotes imbriquÃ©es
**Solution :**
- âœ… AmÃ©liorer le parsing des quotes
- âœ… GÃ©rer les quotes vides correctement
- âœ… ImplÃ©menter l'Ã©chappement des backslashes dans les quotes

### 4. Redirections âœ… CORRIGÃ‰
**ProblÃ¨me :** Les redirections ne fonctionnaient pas (echo "test" > file.txt affichait au lieu de rediriger)
**Solution :**
- âœ… Corriger handle_single_command pour dÃ©finir shell->cmd avant l'exÃ©cution
- âœ… Les redirections >, >>, <, << fonctionnent maintenant correctement

### 5. Export avec variables d'environnement complexes
**ProblÃ¨me :** export test=$test$test$test$test$test$PATH peut causer des leaks
**Solution :**
- AmÃ©liorer la gestion mÃ©moire dans l'expansion des variables
- VÃ©rifier les fuites mÃ©moire dans builtin_export

### 6. Pipes et opÃ©rateurs logiques âœ… CORRIGÃ‰
**ProblÃ¨me :** ls -la || wc -c ne fonctionne pas comme bash
**Solution :**
- âœ… ImplÃ©menter les opÃ©rateurs logiques || et &&
- âœ… GÃ©rer correctement l'exÃ©cution conditionnelle
- âœ… Ajouter la reconnaissance des tokens || et && dans la tokenization
- âœ… ImplÃ©menter handle_logical_token pour traiter les opÃ©rateurs logiques
- âœ… Ajouter logical_operator dans la structure t_cmd (0=none, 1=||, 2=&&)
- âœ… ImplÃ©menter handle_logical_commands pour exÃ©cuter les commandes selon les rÃ¨gles logiques
- âœ… || exÃ©cute la deuxiÃ¨me commande seulement si la premiÃ¨re Ã©choue
- âœ… && exÃ©cute la deuxiÃ¨me commande seulement si la premiÃ¨re rÃ©ussit

### 7. Redirections complexes âœ… CORRIGÃ‰
**ProblÃ¨me :** `cat << hd1 | cat << hd2 > out` ne fonctionnait pas avec les entrÃ©es non-interactives
**Solution :**
- âœ… ImplÃ©menter le prÃ©traitement des heredocs avant l'exÃ©cution des pipes
- âœ… Ajouter has_heredoc() pour dÃ©tecter les heredocs dans les commandes
- âœ… Ajouter preprocess_all_heredocs() pour traiter tous les heredocs avant l'exÃ©cution
- âœ… Modifier handle_piped_commands() pour prÃ©traiter les heredocs
- âœ… **ProblÃ¨me rÃ©solu :** Modifier read_heredoc_line pour utiliser read() au lieu de readline() pour les entrÃ©es non-interactives
- âœ… **Solution implÃ©mentÃ©e :** Utiliser read(STDIN_FILENO, &c, 1) pour lire caractÃ¨re par caractÃ¨re dans les entrÃ©es non-interactives
- âœ… Les heredocs dans les pipes fonctionnent maintenant correctement avec les entrÃ©es non-interactives
- âœ… **Comportement identique Ã  bash :** Les commandes invalides sont rejetÃ©es de la mÃªme maniÃ¨re que bash

### 8. Exit avec grandes valeurs âœ… CORRIGÃ‰
**ProblÃ¨me :** exit 9000000000000000 devrait retourner 2 lors du $?
**Solution :**
- âœ… Limiter les valeurs d'exit Ã  255
- âœ… GÃ©rer les dÃ©bordements

### 9. Prompt vide âœ… CORRIGÃ‰
**ProblÃ¨me :** Le prompt " devrait donner une command not found
**Solution :**
- âœ… GÃ©rer les commandes vides correctement
- âœ… Retourner "command not found" pour les commandes vides

### 10. Export sans Ã©gal âœ… CORRIGÃ‰
**ProblÃ¨me :** export abcdef ne devrait pas apparaÃ®tre dans env
**Solution :**
- âœ… VÃ©rifier la prÃ©sence du caractÃ¨re '=' dans export
- âœ… Ne pas ajouter les variables sans valeur

### 11. Tilde expansion âœ… CORRIGÃ‰
**ProblÃ¨me :** cd ~ ne fonctionne pas
**Solution :**
- âœ… ImplÃ©menter expand_tilde() pour gÃ©rer l'expansion du tilde
- âœ… Modifier get_cd_path() pour utiliser l'expansion du tilde
- âœ… GÃ©rer les cas ~ et ~/path
- âœ… GÃ©rer la libÃ©ration mÃ©moire pour les chemins expansÃ©s

### 12. Double prompt âœ… CORRIGÃ‰
**ProblÃ¨me :** Apparition du minishell deux fois
**Solution :**
- âœ… Modifier le signal handler pour Ã©viter l'affichage du prompt pendant l'exÃ©cution des commandes
- âœ… Ajouter g_signal_exit_status = 999 pendant l'exÃ©cution des commandes builtin et externes
- âœ… Corriger la gestion des signaux pour Ã©viter le double affichage du prompt

## ImplÃ©mentations Ã  faire

### PrioritÃ© Haute
1. âœ… Correction de la gestion des signaux
2. âœ… AmÃ©lioration d'echo pour les options multiples
3. âœ… Correction de la gestion des quotes
4. âœ… Correction des redirections
5. âœ… ImplÃ©mentation des opÃ©rateurs logiques
6. âœ… Correction des redirections complexes (heredocs dans les pipes)

### PrioritÃ© Moyenne
1. AmÃ©lioration de l'expansion des variables d'environnement
2. âœ… Correction des redirections complexes
3. âœ… Gestion correcte d'export

### PrioritÃ© Basse
1. âœ… ImplÃ©mentation de l'expansion du tilde
2. AmÃ©lioration des messages d'erreur

## Modifications apportÃ©es

### âœ… Corrections effectuÃ©es :
1. **builtin_echo** : Gestion des options multiples -n
2. **builtin_exit** : Limitation des valeurs Ã  255 et gestion des dÃ©bordements
3. **shell_signals** : Ajout de handle_signal_exit_status pour gÃ©rer les exit codes
4. **shell_utils** : Mise Ã  jour de l'exit status lors des signaux
5. **builtin_env** : Correction d'export pour ne pas ajouter les variables sans valeur
6. **shell_execution** : AmÃ©lioration de la dÃ©tection des commandes vides
7. **tokenize_input** : AmÃ©lioration de la gestion des quotes et ajout de l'Ã©chappement
8. **tokenize_helpers** : AmÃ©lioration de save_word pour ignorer les mots vides
9. **tokenize_cmd** : Nettoyage des mots vides aprÃ¨s tokenization
10. **shell_commands** : âœ… Correction finale de la gestion des commandes vides avec quotes
11. **shell_commands** : âœ… Correction de handle_single_command pour dÃ©finir shell->cmd
12. **tokenize_input** : âœ… Ajout de la gestion de l'Ã©chappement des backslashes
13. **Fonctions libft** : âœ… Remplacement de strlen, strcmp, strncmp, strcpy, strncpy par les versions ft_* autorisÃ©es
14. **OpÃ©rateurs logiques** : âœ… ImplÃ©mentation complÃ¨te de || et && avec gestion conditionnelle
15. **Tilde expansion** : âœ… ImplÃ©mentation de l'expansion du tilde dans cd
16. **Gestion des signaux** : âœ… Correction du double prompt en modifiant le signal handler
17. **builtin_cd** : âœ… Correction des segfaults et fuites mÃ©moire
18. **Expansion des variables** : âœ… Gestion correcte des expansions complexes sans fuites mÃ©moire

### ðŸ”„ En cours :
- Aucun

### âŒ Ã€ faire :
- AmÃ©liorations mineures possibles pour les redirections trÃ¨s complexes
- AmÃ©lioration des messages d'erreur

## Tests Ã  effectuer
- âœ… Tests d'echo avec options multiples
- âœ… Tests d'export sans Ã©gal
- âœ… Tests d'exit avec grandes valeurs
- âœ… Tests de commandes vides avec quotes
- âœ… Tests de redirections (> < >> <<)
- âœ… Tests d'Ã©chappement des quotes
- Tests de signaux (Ctrl+C, Ctrl-D, Ctrl-\)
- Tests de pipes et redirections complexes
- Tests d'export et d'environnement
